Vagrant.configure("2") do |config|
  config.vm.box = "generic/ubuntu2004"

  config.vm.define :zion do |name|
    name.vm.hostname = "mail.zion.com.br"
    name.vm.provider "libvirt" do |kvm|
      kvm.memory = "1024"
      kvm.cpus = 1
    end
    name.vm.provision "Install-email-tools-zion", type: "shell", inline: <<-SHELL
      sudo apt update
      sudo apt install -y dovecot-managesieved dovecot-sieve mutt
      sudo useradd -m -s /bin/bash -p '$6$hE1KC/fHlS4ZmmYg$uvlJce8oT79MsmtfCViJIj/oUvoQLSTOPHFGspMBGwrBekDdowJeMWRM5PrykI4fjWO6IDcGyV9LKyiCqtS0V0' jhon
      sudo hostnamectl set-hostname mail.zion.com.br

      sudo rm /etc/resolv.conf
      sudo echo 'nameserver 192.168.121.2' > /etc/resolv.conf
    SHELL
  end

  # Instale o 'postfix' manualmente por causa das perguntas

  config.vm.define :notfound do |name|
    name.vm.hostname = "mail.notfound.com.br"
    name.vm.provider "libvirt" do |kvm|
      kvm.memory = "1024"
      kvm.cpus = 1
    end
    name.vm.provision "Install-email-tools-notfound", type: "shell", inline: <<-SHELL
      sudo apt update
      sudo apt install -y dovecot-managesieved dovecot-sieve mutt
      sudo useradd -m -s /bin/bash -p '$6$hE1KC/fHlS4ZmmYg$uvlJce8oT79MsmtfCViJIj/oUvoQLSTOPHFGspMBGwrBekDdowJeMWRM5PrykI4fjWO6IDcGyV9LKyiCqtS0V0' bob
      sudo hostnamectl set-hostname mail.notfound.com.br

      sudo rm /etc/resolv.conf
      sudo echo 'nameserver 192.168.121.2' > /etc/resolv.conf
    SHELL
  end
  
  # Instale o 'postfix' manualmente por causa das perguntas
end



# Run container inside lab network:
#docker network create \
#  --driver=bridge \
#  --subnet=192.168.121.0/24 \
#  --gateway=192.168.121.1 \
#  --opt com.docker.network.bridge.name=virbr1 \
#  dockernet

#docker run -it --rm \
#  --network dockernet \
#  --ip 192.168.121.100 \
#  alpine

